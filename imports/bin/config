#!/bin/sh

# exit if a command fails
set -e

# Configure php-fpm pool
echo "### Configure php-fpm pool..."
rm -f ${CONFIG_PATHS_PHP_FPM_FOLDER}/www.conf
POOL_CONF_TEMPLATE="${BUILD_PATHS_TEMPLATES}/pool.conf"
POOL_CONF_TARGET="${CONFIG_PATHS_PHP_FPM_FOLDER}/${CONFIG_PHP_POOL_NAME:-www}.conf"
echo "$POOL_CONF_TEMPLATE" > envsubst > "$POOL_CONF_TARGET"

# Enable extensions
echo "### Enable extensions..."
for EXT in $CONFIG_PHP_EXTS do IS_ENABLED="$( echo "$CONFIG_PHP_EXT_${EXT}_ENABLED" | envsubst)"; if [ "$IS_ENABLED" = "$GENERAL_KEYS_TRUE" ]; then ENABLED_EXTENSIONS="$ENABLED_EXTENSIONS $EXT"; fi done

# Enable extensions
echo "### Enable extensions..."
if [  ! -z "$ENABLED_EXTENSIONS"  ]; then
    docker-php-ext-enable $ENABLED_EXTENSIONS;
fi


exit 0